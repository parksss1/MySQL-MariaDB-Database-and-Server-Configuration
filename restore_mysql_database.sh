# RESTORE SCRIPT FOR MYSQL .SQL DUMP
# SCRIPT TO BE RAN BY ROOT USER


#!/bin/bash

# BACKUP DIRECTORY
BACKUP_DIR=""

# NAME OF DATABASE
DATABASE_NAME=""

# 'root' MYSQL USER
MYSQL_USER="root" 

# ENTER MYSQL ROOT USER PASSWORD
echo -n "ENTER MYSQL PASSWORD FOR USER 'root': "
read -s MYSQL_PASSWORD
echo

# MOST RECENT .SQL BACKUP FILE
LATEST_BACKUP=$(ls -t ${BACKUP_DIR}/*.sql 2>/dev/null | head -n 1)

# CONFIRM BACKUP FILE WAS FOUND
if [ -z "$LATEST_BACKUP" ]; then
    echo "No backup files found in ${BACKUP_DIR}."
    exit 1
fi

echo "LATEST BACKUP FILE: $LATEST_BACKUP"

# RESTORE BACKUP
echo "RESTORING DATABASE '${DATABASE_NAME}' FROM  $LATEST_BACKUP..."
mysql -u ${MYSQL_USER} -p${MYSQL_PASSWORD} ${DATABASE_NAME} < ${LATEST_BACKUP}

if [ $? -eq 0 ]; then
    echo "DATABASE: '${DATABASE_NAME}' RESTORED FROM ${LATEST_BACKUP}."
else
    echo "RESTORE DATABASE FAILED"
    exit 1
fi
